<link rel="import" href="./todo-item.html">

<dom-module id="todo-list">
  <template>
    <style>
      ul {
        list-style: none;
        margin-left: 0;
        padding-left: 0;
      }
    </style>

    <h2>To Do List</h2>
    <div>
      {{_getUncompletedCount()}} of {{_todos.length}} remaining
      <paper-button on-click="_archiveCompleted">
        Archive Completed
      </paper-button>
    </div>
    <br/>
    <paper-input autofocus
      label="enter new todo here"
      value="{{_todoText}}"
      on-keypress="_todoTextKeyPress">
    </paper-input>
    <paper-button disabled="[[!_todoText]]" on-click="_addTodo">
      Add
    </paper-button>
    <ul>
      <template is="dom-repeat" items="{{_todos}}" as="todo">
        <todo-item todo="[[todo]]"></todo-item>
      </template>
    </ul>
  </template>

  <script>
    let lastId = 0;

    function createTodo(text, done = false) {
      return {id: ++lastId, text, done};
    }

    Polymer({
      is: 'todo-list',
      properties: {
        _todoText: {
          type: String,
          value: ''
        },
        _todos: {
          type: Array,
          value: [
            createTodo('learn Polymer', true),
            createTodo('build a Polymer app')
          ]
        }
      },
      listeners: {
        'delete-todo': '_deleteTodo'
      },
      _addTodo() {
        this.push('_todos', createTodo(this._todoText));
        this._todoText = '';
      },
      _archiveCompleted() {
        this._todos = this._todos.filter(t => !t.done);
      },
      _deleteTodo(event) {
        const todoId = event.detail;
        const index = this._todos.findIndex(t => t.id === todoId);
        this.splice('_todos', index, 1);
      },
      _getUncompletedCount() {
        //TODO: Can you avoid verifying that this._todos is set?
        return this._todos ?
          this._todos.filter(todo => !todo.done).length :
          0;
      },
      _todoTextKeyPress(event) {
        const gotReturn = event.which === 13;
        if (gotReturn) this._addTodo();
      }
    });
  </script>
</dom-module>
